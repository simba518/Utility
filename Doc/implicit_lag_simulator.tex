\documentclass[9pt]{extarticle}
\usepackage[hmargin=0.5in,tmargin=0.5in]{geometry}
\usepackage{amsmath,amssymb}
\usepackage{times}
\usepackage{graphicx}
\usepackage{subfigure}

\usepackage{cleveref}
\usepackage{color}
\newcommand{\TODO}[1]{\textcolor{red}{#1}}

\newcommand{\FPP}[2]{\frac{\partial #1}{\partial #2}}
\newcommand{\argmin}{\operatornamewithlimits{arg\ min}}
\author{Siwang Li}

\title{Simulation using implicit integration with Lagrangian constraints}

%% document begin here
\begin{document}
\maketitle

\setlength{\parskip}{0.5ex}

The motion equation with constraints is
\begin{eqnarray}
 M\ddot{u} + D\dot{u} + f(u) &=& f_{ext} \\
 s.t. Cu &=& u^c
\end{eqnarray}
where $D=\alpha_mM+\alpha_kK(u)$. Applying the constraints using Lagrangian method, we obtain,
\begin{equation}
  \left\{ \begin{array}{rl}
      &M\ddot{u} + D\dot{u} + f(u) + C^T\lambda= f_{ext} \\
      &Cu=u^c
    \end{array} \right.
\end{equation}
Using implicit integration, we have
\begin{eqnarray}
 v_{k+1} &=& v_k + hM^{-1}(f_{ext}-f(u_{k+1})-Dv_{k+1}-C^T\lambda) \\
 u_{k+1} &=& u_{k} + hv_{k+1}\\
 v_{k+1} &=& v_k + hM^{-1}(f_{ext}-f(u_{k} + hv_{k+1})-Dv_{k+1}-C^T\lambda) \\
 v_{k+1} &=& v_k + hM^{-1}(f_{ext}-(f(u_{k})+hK(u_{k})v_{k+1})-Dv_{k+1}-C^T\lambda) \\
 (h^2K(u_{k})+hD+M)v_{k+1}+hC^T\lambda &=& Mv_k + h(f_{ext}-f(u_{k}))\\
 C(u_{k}+hv_{k+1}) &=& u^c\\
 hCv_{k+1} &=& u^c-Cu_{k}
\end{eqnarray}
If we let 
\begin{eqnarray}
 L &=& (h^2+h\alpha_k)K(u_{k})+(1+h\alpha_m)M\\
 A  &=& \left( \begin{array}{cc}
     L & hC^T\\
     hC & O
   \end{array} \right)\\
 b &=& \left( \begin{array}{c}
     Mv_k + h(f_{ext}-f(u_{k}))\\
     u^c-Cu_k
   \end{array} \right)
\end{eqnarray}
Finally we need to solve
\begin{equation}
  \left\{ \begin{array}{rl}
      A \left( \begin{array}{c}
          v_{k+1}\\
          \lambda
        \end{array} \right) = 
      b\\
      u_{k+1} = u_{k} + hv_{k+1}
    \end{array} \right.
\end{equation}

\end{document}
