\documentclass[twocolumn]{article}
\setlength{\columnsep}{3em}
\author{Siwang Li}
\title{Details of Soft Constraint}
\begin{document}
\maketitle

\section{Position Constraint in Full Space}
The motion equation with position constraints in full space is
\begin{equation}
f(u) + D(u)\dot{u} + M \ddot{u} = f_{ext}
\end{equation}
s.t.
$$
\left\{ \begin{array}{rl}
&C_1 u = u_{c1}\\
&C_2 u = u_{c2}\\
&\vdots \\
&C_c u = u_{cc}
\end{array} \right.
$$
\subsection{Barycenter Constraints}
where if barycenter constraint is adopted,
$u_{ci}$ is a $3\times1$ vector indicates the barycenter
of the barycenter of constraint nodes group $i$,
and $C_i$ is the corresponding constraint matrix mapping $u$ to
a $3\times1$ vector. $C_i$ is a sparse matrix with the structure of
$$
C_i := \frac{1}{N_c}
\left| \begin{array}{ccccccc}
  \ldots & O & I & O & O & I &\ldots
  \end{array}\right|
$$
where $I$ is a $3\times3$ identity matrix and $O$ is a $3\times3$ 
zero matrix, and $I$ only appear at the positions of the index of the 
constraint nodes, and $N_c$ is the total number of the constraint nodes
of group $i$.
\subsection{Soft Barycenter Constraints}
Let $E_c$ be the constraint energy function
\begin{equation}
E_c = \sum_{i=1}^{c} \frac{1}{2} \|C_i u - u_{ci}\|_2^2
\end{equation}
Soft constraint can be added as
\begin{equation}
f(u)+ {\lambda}_c {\frac{\partial{E_c}} {\partial{u}}} + D(u)\dot{u} + M \ddot{u} = f_{ext}
\end{equation}
e.g.
\begin{equation}
(f(u)+ {\lambda}_c(\sum_{i=1}^c C_i^T C_i) u) + D(u)\dot{u} + M \ddot{u} = f_{ext}+ {\lambda}_c\sum_{i=1}^c({C_i^T u_{ci}})
\end{equation}
Where $\lambda_c$ is the soft constraint coefficients.
This type of constraints can be added by adding the constraint forces and constraint Stiffness matrix to
original ones:
$$
\left\{ \begin{array}{rl}
&f(u) += \lambda_c (\sum_{i=1}^c C_i^T C_i) u \\\\
&f_{ext} += {\lambda}_c\sum_{i=1}^c({C_i^T u_{ci}})\\\\
&K(u) += \lambda_c (\sum_{i=1}^c C_i^T C_i)
\end{array} \right.
$$

\section{Position Constraint in Reduced Space}
Constraint in reduced sub space is similar to that in full space,
except that the constraint matrix is replaced by
\[
C_i  U
\]
Where $U$ is the basis matrix.

\end{document}
